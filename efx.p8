pico-8 cartridge // http://www.pico-8.com
version 16
__lua__
//menu = [chan,fxname]
m_cursor=1
c_cursor=1
menu={
 {0,"slow"},
 {0,"rvrb"},
 {0,"dstn"},
 {0,"lowp"}
}

function _init()
 music(0)
end

function _update()

 if (btnp(2)) m_cursor-=1
 if (btnp(3)) m_cursor+=1
 
 if (m_cursor<1 or m_cursor>#menu) then
  --m_cursor=min(#menu,#menu+m_cursor)
  if (m_cursor<1)then
   m_cursor=#menu
  else
   m_cursor=m_cursor % #menu
  end
  --m_cursor=(m_cursor+#menu)%#menu
 end
 
 if (btnp(0)) c_cursor-=1
 if (btnp(1)) c_cursor+=1
 
 if (c_cursor<1 or c_cursor>4) then
  if c_cursor<1 then
   c_cursor=4
  else
   c_cursor=c_cursor % 4 
  end
 end
 
 if btnp(4) then
  local v=menu[m_cursor][1]
  menu[m_cursor][1]=bflip(v,c_cursor)
 end
 
 --
 updatefx(menu)
 
end


function _draw()
 cls()
 dr_menu()
end

function dr_menu()
 for i=1,#menu do
  local y=10+(10*i)
  local c=7
  if (m_cursor==i) c=10
  print(menu[i][2],4,y,c)
  
  local cbits={1,2,4,8}
  for cbit=1,#cbits do
   local x=30+(cbit*8)
   local c=7
  
   if (bvec(menu[i][1],cbit)) c=14
   fillp()
   rectfill(x,y,x+4,y+4,c)

   if (cbit==c_cursor  and m_cursor==i) then
    c+=shl(10,4)
    fillp(0b1010010110100101)
    rectfill(x,y,x+4,y+4,c)
   end
  end
  
  
 end
end
-->8
afx = {
 slow=0x5f40, //: play channel twice slower
 rvrb=0x5f41, //: a very short delay (cheap reverb/unison simulation)
 dstn=0x5f42, //: distortion (rounds the output waveform to min or max depending on which is nearest)
 lowp=0x5f43 //: low-pass filter
}

function fx(e,chan)
 assert(afx[e] != nil)
 poke(afx[e], chan)
end

function updatefx(t)
 local cbits={1,2,4,8}
 for f=1,#t do
  fx(t[f][2],t[f][1])
 end
end

function bflip(data,bit)
 local d=data
 local b=shl(1,bit-1)
 return bxor(d,b)
end

function bvec(data,bit)
 local v=shl(1,bit-1)
 if (band(data,v)==v) then
  return true
 else
  return false
 end
end
__sfx__
000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
01010b103b6502c6401f63030630386303f0303e6303f0303f6303f0303f6303f0203e0203f0103f6103f0103f6003f6003f6003f6003f6003f6003f6003f6003f6003f6003f6003f6003f6003f6003f6003f600
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000e002000225002250c2250022503235002250022505235002250c2350022505235002250323500225052350022500225032350022505235002250c22500225002250c225002350322500225052350022507235
011c00002155021555000001f554215512155200000185501b550000001955000000185501855500000000002155021555000001d5541f5511f552000001d5501f550215501f5501d5501a5511a5521a55200000
010e00200c75300000000000c7030000000000147030c7230c7530000000000000003c6230000000000000000c7530000000000000000000000000000000c6230c753000000c753000003c62300000206133c623
010700202492500000249250000024925000003095000000000000000030925000002492500000249153092530920000000000000000309200000000000000003092500000309250000030925000003092500000
010e002000125001250c1220012503132001250012505132001250c1350012505132001250313200125051320012500125031320012505132001250c12500125001250c122001350312200125051320012507132
__music__
01 0a424344
00 0a0b4344
00 0a0b0c44
03 0e4b0c0d

