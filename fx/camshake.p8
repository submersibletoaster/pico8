pico-8 cartridge // http://www.pico-8.com
version 16
__lua__
local cp={0,-128}
local cdv={0,0}

local sv={0,0}
local so={0,0}

local fills={
// 0b1000000000100000.1,
 0b1010111101011111.1,

// 0b0000001000000100.1,
 0b1111010111111010.1,

// 0b0010000001000000.1,
 0b0101111110101111.1,
 
// 0b0000010000000010.1
 0b1111101011110101.1
 
}
local nfills=#fills
local cfill=1
function nextfill()
  fillp(fills[cfill])
  cfill+=1
  if cfill > nfills then
    cfill=1
  end
end

local pals={
 function()
   pal(10,9)
   pal(9,8)
   pal(8,10)
 end,
 function()
   pal(10,8)
   pal(9,10)
   pal(8,9)
 end,
 function()
   pal()
 end
}
npals=#pals
cpal=1
function nextpal()
  pals[cpal]()
  cpal+=1
  if cpal>npals then
    cpal=1
  end
end


function _init()
  
end


function _update60()
  cp[1]+=cdv[1]
  cp[2]+=cdv[2]
  
  cdv[1]*=0.9
  cdv[2]*=0.9

  if btnp(4) then
    so[1]+= (10 - rnd(20))
    so[2]+= (10 - rnd(20))
    sfx(0,1)
  end
  
  if btn(1) then
  	 cdv[1]+=.1
  end
  if btn(0) then
    cdv[1]-=.1
  end
  if btn(3) then  
    cdv[2]+=.1
  end
  if btn(2) then
    cdv[2]-=.1
  end
  

  sv[1] -= flr(so[1]*1.5)
  sv[2] -= flr(so[2]*1.5)
  
  so[1] += sv[1]
  so[2] += sv[2]
     
  // shake offset decay
  so[1]*=0.75
  so[2]*=0.75

  
end

local prev_shake=0
function _draw()
  csh={cp[1]+so[1], cp[2]+so[2]}
  if prev_shake==0 and so[1]>1 then
    nextfill()
    rectfill(0,0,128,128,1)
  elseif prev_shake==1 and so[1]>1 then
    nextfill()
    rectfill(0,0,128,128,1)
  else
    cls(1)
    fillp()
  end
  -- floor
  pal()
  camera( csh[1], csh[2] )
  if so[1]>1 then
   nextfill()
  end
  for i=0,63 do
   for x=0,63 do
    circfill(x*32,-i*32,5,2)
   end
  end

  
  -- mid-field
  camera( csh[1]*1.25, csh[2]*1.25 )
  if so[1] > 1 then
    nextfill()
  end

  for i=0,32 do
   for x=0,32 do
    circfill(x*40,-i*40,8,5)
   end
  end
  
  -- close up
  camera( csh[1]*1.5, csh[2]*1.5 )


  for i=0,32 do
   for x=0,32 do
     if so[1]>1 then
    nextfill()
  end

    circfill(x*48,-i*48,12,10)    
   end
  end

  if so[1] > 1 then
    prev_shake=1
  else
    prev_shake=0
  end
  
  camera(so[1],so[2])
  nextpal()
  fillp()
  spr(64,60,60)
  
  //camera(0,0)
  //fillp()
  //line(64,64, 64+so[1], 64+so[2],15 )
end


__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
06666660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
6dddddd5000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
6d5555d5000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
6d59a6d5000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
6d5896d5000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
6d6666d5000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
6dddddd5000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
05555550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44444444000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44444444000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44454445000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44452451000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44d52444000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44524444000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44541444000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44544444000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
8080808080808080808080808080808000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
000100000c6500c6500c6500c3500e6500e650123500e650113500f640103400e3400f6400d3300f6300e62000000000000000000000000000000000000000000000000000000000000000000000000000000000
