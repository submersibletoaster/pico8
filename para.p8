pico-8 cartridge // http://www.pico-8.com
version 16
__lua__
local l1={x=0,y=0}
local l2={x=0,y=0}
local l3={x=0,y=0}

gfx=0x6000
mod={3,2,2,2,2,1,1,1,0,0,
	-1,-1,-1,-2,-2,-2,-2,-3,
 -2,-2,-2,-2,-1,-1,-1,0,
 1,1,1,2,2,2,2 }
mod_step=1

function _init()

end

function _update60()
 l1.x+=0.5
 l2.x+=1
 l3.x+=2
 
 mod_step+=0.2
 if mod_step > #mod then
  mod_step=1
 end
 
 if l1.x> shl(1,10) then
  l1.x=0
 end
 if l2.x> shl(1,10) then
  l2.x=0
 end
 if l3.x> shl(1,10) then
  l3.x=0
 end
 
end

function _draw()

  -- sky
 camera()
 fillp()
 color(12)
-- rectfill(0,0,128,75)
 draw_sky(76)

 -- grass
 -- gradient to horizon
 fillp(0b1111010110101010)
 rectfill(0,76,127,76+4,shl(11,4)+3)
 fillp(0b0101101010100101)
 rectfill(0,76+4,127,76+8,shl(11,4)+3)
 fillp(0b1000001001000001)
 rectfill(0,76+8,127,76+12,shl(11,4)+3)
 
 fillp()


 -- mountains
 camera(l1.x,0)
 mapdraw(0,0,0,60,128,2)

 -- trees
 camera(l2.x,0)
 mapdraw(0,2,0,73,128,2)
 

 --dirt
 camera(l3.x,0)
 mapdraw(0,4,0,73+12,128,3)
 
 --reflection
 local roff=102
 
 for i=0,128-(roff+1) do
   local ms=1+ ((mod_step+i) % #mod)
   
 
   memcpy(
   	gfx+ ( (roff+i)*64 ),
   	gfx+ ( (roff-(i*2))*64 ) + mod[flr(ms)],
   	64
   )
 end
 
 camera()

 color(8) 
 rect(0,roff,127,127)

 color(4)
 
 print(stat(1),10,10)

end
-->8
reflect={
   {0,0},
   {1,0},
   {2,0},
   {3,1},
   {4,2},
   {5,1},
   {6,13},
   {7,6},
   {8,2},
   {9,4},
   {10,9},
   {11,3},
   {12,1},
   {13,5},
   {14,4},
   {15,14}
}

function ref_pal(p)
 p = p  or 0
 
 for t in all(reflect) do
  pal(t[1],t[2],p)
 end
end
-->8

local cols={7,7,6,12,12,12,12,12,13,1}
local ptrns={
0b0111011001000000,
0b1011001100100010,
0b1101100100010001,
0b1110110010000000
}
function draw_sky(y)

 for i=1,#cols-1 do
  color(cols[i]*16+cols[i+1])
  for j=0,3 do
   fillp(ptrns[j+1])
   rectfill(0,y,127,y-1)
   y-=2
  end
 end
end
__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000006c6c6c6c6c6c6c6c4d44d44d4d44d44d00000000
0000000000000000000000000000000000000000000000070000000000000000000000000000000000000000ccccccccccccccccd44d44d4d44664d400000000
0000000000000000000000000000000000000000000000770000000000000000000000000000000000000000cccccccccccccccc4d44d44d4d66664d00000000
0000000000000077000000000000000000000000000000777000000000000000000000000000000000000000cccccccccccccccc44d44d444666655400000000
0000000000000077700000000000000000000000000007777000000000000000000000000000000000000000cccccccccccccccc4d44d44d4666555d00000000
0000000000000777770000000000000000000000000007677000000000000000000000000000000000000000ccccccccccccccccd44d44d4d66555d400000000
0000000000007776777000000000000006660000000066767600000000000000000000000000000000000000cccccccccccccccc44d44d4444d44d4400000000
000000000007766666700000dd50000066666000000767666600000000000000000006000000000000000000ccccccccccccccccd44d44d4d44d44d400000000
0000000000666666666600dddd5000066666660000d666666660000000000000000666000000000000000660cccccccccccccccc000000000000000000000000
000000000666666666666ddddd550066666666600d66666666600000000000dd0006666000000005500066661ccc1ccc1ccc1ccc0b0000000000000000000000
000000006666666666d666ddddd500666666666dd6666666666600dddd000ddd556666d00000005555006666cc1ccc1ccc1ccc1cb00b03030000030000000000
00000000666666666d56666dddd5566666666ddd6666666666666dddddd55ddd5666666dd6000555550066661ccc1ccc1ccc1cccb03b0303030b300b00000000
000000006666666ddd66666dddddd66666666d66666666666666666ddd55dddd66666666ddd6556665566666c1c1c1c1c1c1c1c13333343d3333333300000000
00000000666666ddd566666ddddd6666666dd66666666666666666666ddddd666666666666d66666666666661c1c1c1c1c1c1c1cd44d44d4d44d44d400000000
0000000066666dd556666666ddd6666666666666666666666666666666666666666666666666666666666666111111111111111144d44d4444d44d4400000000
000000006666666666666666d6666666666666666666666666666666666666666666666666666666666666661111111111111111d44d44d4d44d44d400000000
0000330000b3003bb000000000000330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000b33300b333bb3330000300330b333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00b333333333b3333330b333333b3333000000033330000330000000000000000000000000000000000000000000000000000000000000000000000000000000
303333333333b333333b333333b3333330300333333300b333000000000000000000000000000000000000000000000000000000000000000000000000000000
3333333b333333333333333333b33333333333333333333333033330000000000000000000000000000000000000000000000000000000000000000000000000
3333333b333333333333333333333333333333b33b33333333b33333000000000000000000000000000000000000000000000000000000000000000000000000
3333333b333b333333333b333333333333333b333333033333333333000000000000000000000000000000000000000000000000000000000000000000000000
333333533333b3333333b333333333b333333333333d033333054330000000000000000000000000000000000000000000000000000000000000000000000000
53335533b33335d3333333333333333bb3333335054d005300054d00000000000000000000000000000000aaaa00000000000000000000000000000000000000
03333933b33334d59333333333333333d9433305054d005d0005400000000000000000449900000000000a9aaaa0000000000000000000000000000000000000
0d339933333354d59933333433333333d094500505400050000040006000000000000044449999000099999aaaaaaaa000000000000000000000000000000000
0d333954bd9454d099454d9459333335d094500005400000000000006000000499aa444444499990aaa9aaa99999aaaa00499000000000000000000000000000
0d5339540d9404d099454d9459405055004450000040000000000000660004444994444444999999aaaaa9999999999aa5599990000000000000000000000000
0d5099500d9400d099404d94594050050044000000000000000000006666444499999944499449999aa999999994999955449999000000000000000000000000
000099000d9400009900409409400000004400000000000000000000666666999999999999444999999999999449999444449999000000000000000000000000
00009900009400009900009409400000000000000000000000000000666666669999999999999999999999999999444444499999000000000000000000000000
__map__
01020304050607080901020304050607082728292a2b2c28292a2b2c2c0a0102030407080708090a0102030405060708090a0a07030408070708090a0102030405060708090a010203040506070102030405060708090a0708090102030408040708090a0102030405060708090102030405060708090a090102070405020308
11121314151617181911121314151617183738393a3b3c38393a3b3c3c1a1112131414181718191a1112131415161718191a1112131415161718191a1112131415161314191a111213141516171112131415161718191a171819111213141112171819191112131415161a181911121314151617181912131112171415161318
2021222320212223202122232021222320212223202122232425262425212223202122202122232223202122232021222320212223202122232021222320202122232425262021222324212021222324232021222320212224252624252021222320212223202122232021222320212223202122212221222320212220212223
3031323330313233303132333031323330313233303132333435363435313233303132303132333233303132333031323330313233303132333031323330303132333435363031323334313031323334333031323330313234353634353031323330313233303132333031323330313233303132313231323330313230313233
1d1e1d1e1d1e1d1e1d1e1d1e1d1e1d1e1d1e1d1e1d1e1d1e1d1e1d1e1d1e1d1e1d1e1d1e1d1e1d1e1d1e1d1e1d1e1d1e1d1e1d1e1d1e1d1e1d1e1d1e1d1e1d1e1d1e1d1e1d1e1d1e1d1e1d1e1d1e1d1e1d1e1d1e1d1e1d1e1d1e1d1e1d1e1d1e1d1e1d1e1d1e1d1e1d1e1d1e1d1e1d1e1d1e1d1e1d1e1d1e1d1e1d1e1d1e1d1e
0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0e0d0d0d0d0d0d0d0d0d0d0d0e0d0d0d0d0d0d0e0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0e0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0e0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d
0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d000000000000
