pico-8 cartridge // http://www.pico-8.com
version 18
__lua__
--
theta=0
gamma=0
beta=0

dt=0
dg=0
db=0

str=0.1

function _update60()
  if btnp(0) then
    --theta+=0.01
    dt=str
  end
  
  if btnp(1) then
    --theta-=0.01
    dt=-str
  end
  
  if btnp(2) then
    --gamma+=0.01
    dg=str
  end
  if btnp(3) then
    -- gamma-=0.01
    dg=-str
  end
  
  if btnp(4) then
    db=str
  end
  if btnp(5) then
    db=-str
  end
  
  dt=damp(dt)
  dg=damp(dg)
  db=damp(db)
  
  theta+=dt
  gamma+=dg
  beta+=db
  
  
  
  
end

function damp(v)
  local n = (1-sqrt(1+abs(v))) * sgn(v)
  return  v+n
end

function spring(p,r,k)
  k = k or 0.5
  
end

function _draw()
  cls()
  dr_bg()
  dr_cube()
  camera()
  --dr_player(1,{x=40,y=24})
  --dr_player(2,{x=80,y=30},true)
  print(dt,10,60)
  print(dg,10,70)
  print(db,10,80)
  print(stat(1),40,80,5)
end
-->8
-- scenery

function dr_bg()
  line(16,64,64,48,1)
  line(64,48,112,64,1)
  line(112,64,64,80,1)
  line(64,80,16,64,1)
end
-->8
-- player
pz={
 {hd=72,col={8,2} },
 {hd=70,col={12,1} },
 {hd=72,col={11,3} },
}

function dr_player(n,pos,flp)
  flp=flp or false
  -- body
  if flp then
    pal(8,pz[n].col[2] )
    pal(2,pz[n].col[1] )
  else
    pal(8,pz[n].col[1] )
    pal(2,pz[n].col[2] )
  end
  
  spr(100,pos.x,pos.y+10,2,2,flp)
  -- head
  
  pset()
  
  spr(pz[n].hd,
    pos.x,pos.y,2,2,flp)
end
-->8
-- rendering
x=1
y=2
z=3

cube={
  {-20,-20,-20},
  {20,-20,-20},
  {20,-20,20},
  {-20,-20,20},
  {-20,20,20},
  {-20,20,-20},
  {20,20,-20},
  {20,20,20}
}

function rot3dy(node,th)

  sin_t = sin(th)
  cos_t = cos(th)
  
  local r={}
  r[x] = (node[x] * cos_t)
          - (node[z] * sin_t);
  r[z] = (node[z] * cos_t) 
          + (node[x] * sin_t);
  r[y] = node[y]
  return r  
end

function rot3dx(node,g)
  sin_g = sin(g)
  cos_g = cos(g)
  local r={}
  r[x] = node[x]
  r[y] = (node[y]*cos_g)
          - (node[z]*sin_g)
  r[z] = (node[z] * cos_g)
          + (node[y] * sin_g)
  return r
end

function rot3dz(node,g)
  sin_g = sin(g)
  cos_g = cos(g)
  local r={}
  r[z] = node[z]
  r[y] = (node[y]*cos_g)
         - (node[x]*sin_g)
  r[x] = (node[x]*cos_g)
         + (node[y]*sin_g)
  return r
end

sqrt2 = sqrt(2)
sqrt6 = sqrt(6)

function proj2d(vec)
local  r={}
 r[x] = ( vec[x]-vec[z])/sqrt2;
 r[y] = (vec[x]+2*vec[y]+vec[z])/sqrt6;
 return r
end

function dr_cube()
  camera(-32,-42)
  proj={}

  for n = 1,#cube do
    local r = proj2d(
      rot3dz(
       rot3dy(
        cube[n], theta
       ),
       beta
      )
    )
    proj[n] = r
    --line(r[x],r[y],5)
    pset(r[x],r[y],10)
    
  end

end
__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000004444000000000000444400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000049444940000000004944494000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000494449440000000049444944000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0007700000004fffff40000000004fffff4000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
007007000000fffffff000000000fffffff000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000fffffff000000000fffffff000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000fffffff000000000fffffff000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000fffffff000000000fffffff000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000f44444f000000000f44444f000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000004fffff40000000004fffff4000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000004fffff40000000004fffff4000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000044444440000000004444444000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000044444440000000004444444000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000044444440000000004444444000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000004444400000000000444440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000ffffff00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000ffffff00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000ffff000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000ffff000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000ffffff00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000ffffff00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000cccccc00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000cccccc00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000cccccc00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000f00f000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000f00f000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000f00f000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000c00c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000cc00cc00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000ccc00ccc0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000400000000000000010000000000000009000000000000000000000000000004440000000000000000000000000000000000000000000000000000000
00000004440000000000000111000000000000099900000000000000000000000000444444400000000000000000000000000000000000000000000000000000
000000444440000000000011111000000000009999900000000000fff00000000044444444444000000000000000000000000000000000000000000000000000
0000044444440000000001111111000000000999999900000000fffffff000000444444224444440000000000000000000000000000000000000000000000000
000044444444400000001111111110000000999999999000000fffff76fff0000244444442444ff0000000000000000000000000000000000000000000000000
00044444444444000001111111111100000999999999990000fffff677ffff000d224444244ffff0000000000000000000000000000000000000000000000000
000d444444444f000005111111111400000d999999999f0000ffffff6ffffff00ddd22444ffffff0000000000000000000000000000000000000000000000000
000dd4444444ff000005511111114400000dd9999999ff000dddfffffffffff00dddd22fffff7ff0000000000000000000000000000000000000000000000000
000ddd44444f7f000005551111144400000ddd99999fff000dddddfffffffff000ddd22ff7ffff40000000000000000000000000000000000000000000000000
000dddd444ffff000005555111444400000dddd999ffff000ddddddfffff7ff000dddd2ffff44f40000000000000000000000000000000000000000000000000
000ddddd4f7fff000005555514444400000ddddd9fffff000ddddddff7ffff00000ddd2ff44ff400000000000000000000000000000000000000000000000000
0000dddddffff00000005555544440000000dddddffff0000ddddddfffffff000000dd2ffff44400000000000000000000000000000000000000000000000000
00000ddddfff0000000005555444000000000ddddfff000000dddddffffff00000000054f4445400000000000000000000000000000000000000000000000000
000000dddff000000000005554400000000000dddff000000000dddffff000000000005444444400000000000000000000000000000000000000000000000000
0000000ddf00000000000005540000000000000ddf00000000000000000000000000000044454400000000000000000000000000000000000000000000000000
00000000f0000000000000004000000000000000f000000000000000000000000000000000440000000000000000000000000000000000000000000000000000
00000044400000000000004440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00004444444000000000444444400000000000000666000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00444444444440000044444444444000000000066666660000000000000000000000000000000000000000000000000000000000000000000000000000000000
44444444444444404444444444444440000006666666df0000000000000000000000000000000000000000000000000000000000000000000000000000000000
dd44444444444ff0dd44444444444ff0000d666666ddff0000000000000000000000000000000000000000000000000000000000000000000000000000000000
dddd4444444ffff0dddd4444444ffff0000ddd66dddfff0000000000000000000000000000000000000000000000000000000000000000000000000000000000
dddddd444ffffff0dddddd444ffffff0000ddddfffffff0000000000000000000000000000000000000000000000000000000000000000000000000000000000
dddddddffffffff0dddddddfffff7ff0000ddddfffffff0000000000000000000000000000000000000000000000000000000000000000000000000000000000
dddddddffffffff0dddddddff7fffff0000ddddfffffff0000000000000000000000000000000000000000000000000000000000000000000000000000000000
dddddddffffffff0dddddddffffffff0000ddddfffff880000000000000000000000000000000000000000000000000000000000000000000000000000000000
00dddddffffff00000dddddffffff0000002dddfff88880000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000dddffff000000000dddffff00000000222df8888880000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000dff0000000000000dff0000000000222288888880000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000222288828000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000022288800000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000280000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
33000333333003330333333003333330333333300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
33003330333003330330003303333330330003330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
33333300333003330330003303300000330000330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
33333000333003330333333003333000330003330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
33333000333003330330000303333000333333300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
33333300333003330330000303300000330333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
33003330033333300333333303333330330033300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
33000333003333000333333003333330330003330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
